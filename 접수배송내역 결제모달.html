<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>결제하기 풀 모달 (v12 - 간편결제 탭 로직 수정)</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* [v12] Master Guide CSS */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html, body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f4f5f7; color: #333; font-size: 16px; line-height: 1.6;
            height: 100%; 
            overflow: hidden; /* 전체 화면 스크롤 방지 */
            width: 100%; /* 가로폭 고정 */
        }
        ul, li { list-style: none; }
        button { font-family: inherit; border: none; cursor: pointer; background: none; padding: 0; }
        input, select { font-family: inherit; }
        
        /* Layout */
        .mobile-wrap { width: 100%; height: 100%; background-color: #fff; position: relative; }
        
        /* Buttons */
        .dark-button {
            background: #424242; color: white; height: 44px; padding: 7px 19px; border-radius: 6px; border: none;
            font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s;
            display: inline-flex; align-items: center; justify-content: center; width: 100%;
        }
        .dark-button:active { transform: scale(0.98); }

        /* Modal Styles */
        .modal-overlay {
            position: fixed; inset: 0; background: #fff; display: flex;
            align-items: flex-start; justify-content: center; z-index: 1000;
        }
        .modal-content {
            background: white; width: 100%; height: 100%; 
            display: flex; flex-direction: column;
            overflow: hidden; /* 컨텐츠 넘침 방지 */
        }
        .modal-header {
            display: flex; justify-content: flex-start; align-items: center;
            padding: 0 16px; position: relative; height: 56px; flex-shrink: 0;
            border-bottom: 1px solid #f0f0f0;
        }
        .modal-title { font-size: 18px; font-weight: 700; color: black; }
        .btn-modal-close {
            position: absolute; right: 16px; top: 50%; transform: translateY(-50%);
            width: 24px; height: 24px; cursor: pointer; color: #333;
        }
        
        /* [MODIFIED] 가로 스크롤 방지 추가 */
        .modal-body { 
            padding: 0 20px 20px 20px; 
            overflow-y: auto; 
            overflow-x: hidden; /* 가로 스크롤 강제 숨김 */
            flex-grow: 1; 
            -webkit-overflow-scrolling: touch;
            width: 100%; /* 폭 고정 */
        }
        
        .modal-footer { 
            padding: 20px; background: #fff; border-top: 1px solid #f0f0f0; 
            flex-shrink: 0; padding-bottom: calc(20px + env(safe-area-inset-bottom));
        }

        /* Total Amount */
        .payment-total-section {
            text-align: center; padding: 12px 0; background: #f9f9f9; 
            width: calc(100% + 40px); margin-left: -20px; margin-bottom: 24px;
            border-bottom: 1px solid #e8e8e9;
        }
        .payment-total-label { font-size: 14px; color: #666; margin-bottom: 6px; }
        .payment-total-value { font-size: 28px; font-weight: 700; color: #333; }

        .section-title { font-size: 14px; font-weight: 600; color: #333; margin-bottom: 12px; }

        /* Payment Method Chips (Main) */
        .payment-method-chips { 
            display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 8px; 
        }
        .payment-chip-lg { 
            background: white; border: 1px solid #e8e8e9; color: #424242; 
            height: 48px; padding: 7px 4px; border-radius: 6px; 
            font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s; 
            display: inline-flex; align-items: center; justify-content: center; gap: 6px;
        }
        .payment-chip-lg.active { border-color: #4e6ee4; background: #f0f3ff; color: #4e6ee4; font-weight: 600; }
        .payment-chip-lg:active { transform: scale(0.98); }
        .payment-chip-lg svg { width: 20px; height: 20px; flex-shrink: 0; }

        /* Simple Payment Provider Chips */
        .simple-payment-chips {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px;
            margin-bottom: 24px;
        }
        .payment-chip-sm {
            background: white; border: 1px solid #e8e8e9; color: #424242;
            height: 40px; padding: 7px 8px; border-radius: 6px;
            font-size: 13px; font-weight: 500; cursor: pointer; transition: all 0.2s;
            display: inline-flex; align-items: center; justify-content: center;
        }
        .payment-chip-sm img { max-height: 16px; max-width: 100%; }
        .payment-chip-sm.active { border-color: #4e6ee4; background: #f0f3ff; color: #4e6ee4; font-weight: 600; }
        .payment-chip-sm:active { transform: scale(0.98); }

        /* Styles from payment-step-2.html */
        .modal-tab-nav { display: flex; gap: 8px; margin-bottom: 16px; }
        .modal-tab-nav .single-chip { font-weight: 500; }
        .single-chip { 
            display: inline-flex; align-items: center; justify-content: center; 
            padding: 6px 12px; border-radius: 100px; font-size: 14px; 
            cursor: pointer; transition: all 0.2s; user-select: none; 
        }
        .single-chip-off { background: #f5f5f6; color: #8a8a92; }
        .single-chip-on { background: #4e6ee4; color: white; }
        .single-chip:active { transform: scale(0.95); }

        .tabs-scroll-wrapper {
            overflow-x: auto; white-space: nowrap; -ms-overflow-style: none; scrollbar-width: none;
            display: flex; gap: 8px; padding-bottom: 4px;
        }
        .tabs-scroll-wrapper::-webkit-scrollbar { display: none; }

        .horizontal-card-item {
            display: flex; flex-direction: column; justify-content: space-between;
            flex-shrink: 0; width: 140px; height: 100px;
            border: 1px solid #e8e8e9; border-radius: 6px; padding: 12px;
            cursor: pointer; transition: all 0.2s;
        }
        .horizontal-card-item.selected { border-color: #4e6ee4; background: #f0f3ff; }
        .horizontal-card-item:hover { background-color: #f8f8f9; }
        .horizontal-card-item.selected:hover { background-color: #e6edff; }

        .horizontal-card-header { display: flex; align-items: center; gap: 8px; }
        .horizontal-card-logo { width: 24px; height: 24px; flex-shrink: 0; object-fit: contain;}
        .horizontal-card-logo.card { width: auto; height: 24px; }
        .horizontal-card-name { font-size: 14px; font-weight: 600; color: #333; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .horizontal-card-info { font-size: 12px; color: #888; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .horizontal-card-info .type { font-size: 11px; color: #555; display: block; margin-top: 2px; }
        
        .horizontal-card-item.add-card {
            border-style: dashed; border-color: #ccc; background: #fcfcfc; color: #666;
            align-items: center; justify-content: center; gap: 4px; font-size: 13px; font-weight: 500;
        }
        .horizontal-card-item.add-card svg { width: 18px; height: 18px; stroke-width: 2.5; }

        /* View Panels */
        .payment-content-panel { display: none; }
        .payment-content-panel.active { display: block; }
        
        /* Sub-Views (Default vs Specific Provider) */
        .simple-payment-sub-view { display: none; }
        .simple-payment-sub-view.active { display: block; }

        /* Sub-Tabs Content (Card/Account) */
        .form-fields-wrapper { display: none; }
        .form-fields-wrapper.active { display: block; }

        /* Forms */
        .form-group { margin-bottom: 16px; }
        .form-group label { display: block; font-size: 13px; font-weight: 600; color: #333; margin-bottom: 6px; }
        .input-wrapper { position: relative; width: 100%; }
        .input-wrapper select {
            width: 100%; height: 44px; padding: 0 32px 0 12px; border: 1px solid #e8e8e9; border-radius: 6px;
            font-size: 14px; background: #fff; appearance: none; outline: none; color: #333;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        .input-wrapper::after {
            content: ''; position: absolute; right: 12px; top: 50%; transform: translateY(-50%);
            width: 16px; height: 16px; pointer-events: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23555' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M6 9l6 6l6 -6' /%3E%3C/svg%3E");
        }
        .disclaimer { font-size: 12px; color: #888; margin-top: 8px; line-height: 1.5; }
        
        svg { width: 100%; height: 100%; }
    </style>
</head>
<body>

    <div class="modal-overlay" id="payment-modal-overlay">
        <div class="modal-content">
            
            <div class="modal-header">
                <h2 class="modal-title">결제하기</h2>
                <div class="btn-modal-close" onclick="alert('닫기 버튼 클릭')">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </div>
            </div>

            <div class="modal-body">
                
                <div class="payment-total-section">
                    <div class="payment-total-label">결제 금액</div>
                    <div class="payment-total-value">₩100,000</div>
                </div>
                
                <h3 class="section-title">결제수단</h3>
                <div class="payment-method-chips" id="payment-method-chips">
                    <button class="payment-chip-lg active" data-method="simple-payment" onclick="selectPaymentMethod(this)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-wallet"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M17 8v-3a1 1 0 0 0 -1 -1h-10a2 2 0 0 0 0 4h12a1 1 0 0 1 1 1v3m0 4v3a1 1 0 0 1 -1 1h-12a2 2 0 0 1 -2 -2v-12" /><path d="M20 12v4h-4a2 2 0 0 1 0 -4h4" /></svg>
                        간편결제
                    </button>
                    <button class="payment-chip-lg" data-method="credit-card" onclick="selectPaymentMethod(this)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-credit-card"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 5m0 3a3 3 0 0 1 3 -3h12a3 3 0 0 1 3 3v8a3 3 0 0 1 -3 3h-12a3 3 0 0 1 -3 -3z" /><path d="M3 10l18 0" /><path d="M7 15l.01 0" /><path d="M11 15l2 0" /></svg>
                        신용카드
                    </button>
                </div>

                <div class="payment-content-panel active" id="payment-content-simple-payment">
                    
                    <div class="simple-payment-chips" id="simple-payment-chips">
                        <button class="payment-chip-sm" onclick="selectSimpleProvider(this, 'Kakao')">
                            <img src="assets/images/kakaopay.png" alt="카카오페이" style="width: 60px;">
                        </button>
                        <button class="payment-chip-sm" onclick="selectSimpleProvider(this, 'Toss')">
                            <img src="assets/images/tosspay.png" alt="토스페이" style="width: 80px; max-height: 30px;">
                        </button>
                        <button class="payment-chip-sm" onclick="selectSimpleProvider(this, 'Naver')">
                            <img src="assets/images/npay.png" alt="네이버페이" style="width: 47px;">
                        </button>
                        <button class="payment-chip-sm" onclick="selectSimpleProvider(this, 'Payco')">
                            <img src="assets/images/payco.png" alt="페이코" style="height: 12px;">
                        </button>
                        <button class="payment-chip-sm" onclick="selectSimpleProvider(this, 'PayPal')">
                            <img src="assets/images/paypal.png" alt="페이팔" style="width: 55px;">
                        </button>
                    </div>

                    <div class="simple-payment-sub-view active" id="simple-payment-view-default">
                        <nav class="modal-tab-nav" id="simple-payment-tabs">
                            <div class="single-chip single-chip-on" data-tab="card" onclick="selectSimplePaymentTab(this, 'card')">신용/체크카드</div>
                            <div class="single-chip single-chip-off" data-tab="account" onclick="selectSimplePaymentTab(this, 'account')">계좌이체</div>
                        </nav>
                        
                        <div class="form-fields-wrapper active" data-tab-content="card" id="simple-payment-content-card">
                            <div class="tabs-scroll-wrapper">
                                <div class="horizontal-card-item selected" onclick="selectRegisteredPayment(this)">
                                    <div class="horizontal-card-header">
                                        <img src="https://via.placeholder.com/40x24/00408B/FFFFFF?text=KB" alt="KB" class="horizontal-card-logo card">
                                    </div>
                                    <div>
                                        <div class="horizontal-card-name">케이뱅크 SIM...</div>
                                        <div class="horizontal-card-info">1234-56**-****-7890<span class="type">체크카드</span></div>
                                    </div>
                                </div>
                                <div class="horizontal-card-item" onclick="selectRegisteredPayment(this)">
                                    <div class="horizontal-card-header">
                                        <img src="https://via.placeholder.com/40x24/000000/FFFFFF?text=HYUNDAI" alt="Hyundai" class="horizontal-card-logo card">
                                    </div>
                                    <div>
                                        <div class="horizontal-card-name">현대카드 ZERO...</div>
                                        <div class="horizontal-card-info">1234-56**-****-7890<span class="type">신용카드</span></div>
                                    </div>
                                </div>
                                <button class="horizontal-card-item add-card" onclick="alert('카드 등록 (구현 필요)')">
                                    <svg xmlns="http://www.w3.org/2000/svg" stroke="#555" width="24" height="24" viewBox="0 0 24 24"><path d="M12 5l0 14"></path><path d="M5 12l14 0"></path></svg>
                                    카드 등록하기
                                </button>
                            </div>
                        </div>
                        
                        <div class="form-fields-wrapper" data-tab-content="account" id="simple-payment-content-account">
                             <div class="tabs-scroll-wrapper">
                                <div class="horizontal-card-item" onclick="selectRegisteredPayment(this)">
                                    <div class="horizontal-card-header">
                                         <img src="https://via.placeholder.com/24x24/00408B/FFFFFF?text=S" alt="SH" class="horizontal-card-logo">
                                        <div class="horizontal-card-name">신한은행</div>
                                    </div>
                                    <div>
                                        <div class="horizontal-card-info">110-***-***6204</div>
                                    </div>
                                </div>
                                <div class="horizontal-card-item" onclick="selectRegisteredPayment(this)">
                                    <div class="horizontal-card-header">
                                         <img src="https://via.placeholder.com/24x24/007bff/FFFFFF?text=W" alt="WOORI" class="horizontal-card-logo">
                                        <div class="horizontal-card-name">우리은행</div>
                                    </div>
                                    <div>
                                        <div class="horizontal-card-info">1002-***-***449</div>
                                    </div>
                                </div>
                                 <button class="horizontal-card-item add-card" onclick="alert('계좌 등록 (구현 필요)')">
                                    <svg xmlns="http://www.w3.org/2000/svg" stroke="#555" width="24" height="24" viewBox="0 0 24 24"><path d="M12 5l0 14"></path><path d="M5 12l14 0"></path></svg>
                                    계좌 등록하기
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="simple-payment-sub-view" id="simple-payment-view-provider">
                        <p class="disclaimer" style="text-align:center; margin-top: 40px;" id="provider-message">
                            </p>
                    </div>
                </div>

                <div class="payment-content-panel" id="payment-content-credit-card">
                    <div style="height: 8px;"></div>

                    <div class="form-group">
                        <label>카드사 선택</label>
                        <div class="input-wrapper">
                            <select>
                                <option value="">카드사를 선택해주세요</option>
                                <option value="shinhan">신한(구 LG카드 포함)</option>
                                <option value="samsung">삼성</option>
                                <option value="hyundai">현대</option>
                                <option value="kb">KB국민</option>
                                <option value="lotte">롯데</option>
                                <option value="woori">우리</option>
                                <option value="hana">하나</option>
                                <option value="bc">비씨</option>
                                <option value="nh">NH농협</option>
                                <option value="keb">외환</option>
                                <option value="kakao">카카오뱅크</option>
                                <option value="union">중국은련</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>할부 개월</label>
                        <div class="input-wrapper">
                            <select>
                                <option value="0">일시불</option>
                                <option value="1">1개월(무이자)</option>
                                <option value="2">2개월(무이자)</option>
                                <option value="3">3개월(무이자)</option>
                                <option value="4">4개월</option>
                                <option value="5">5개월</option>
                                <option value="6">6개월</option>
                                <option value="7">7개월</option>
                                <option value="8">8개월</option>
                                <option value="9">9개월</option>
                                <option value="10">10개월</option>
                                <option value="11">11개월</option>
                                <option value="12">12개월</option>
                            </select>
                        </div>
                        <p class="disclaimer">법인 카드로 결제 시, 할부 적용이 되지 않아요</p>
                    </div>
                </div>

            </div>

            <div class="modal-footer">
                <button class="dark-button" onclick="alert('결제가 진행됩니다.')">결제하기</button>
            </div>
        </div>
    </div>

    <script>
        // Payment Method Selection (Main Tabs)
        function selectPaymentMethod(chip) {
            const method = chip.dataset.method;

            // Toggle Main Chips
            document.querySelectorAll('#payment-method-chips .payment-chip-lg').forEach(c => c.classList.remove('active'));
            chip.classList.add('active');

            // Toggle Content Panels
            document.querySelectorAll('.payment-content-panel').forEach(panel => {
                panel.classList.remove('active');
            });
            document.getElementById(`payment-content-${method}`).classList.add('active');

            // [RESET] If switching to Simple Payment, reset to Default View
            if (method === 'simple-payment') {
                resetSimplePaymentToDefault();
            }
        }

        // Simple Payment Provider Selection
        function selectSimpleProvider(btn, providerName) {
            // 1. Highlight clicked provider button
            document.querySelectorAll('#simple-payment-chips .payment-chip-sm').forEach(el => el.classList.remove('active'));
            btn.classList.add('active');

            // 2. [NEW] Deselect Main "Simple Payment" Tab
            // 간편결제 탭의 active 클래스를 제거하여 비활성화 상태(흰색 배경)로 만듦
            document.querySelectorAll('#payment-method-chips .payment-chip-lg').forEach(c => c.classList.remove('active'));

            // 3. Switch View: Default -> Provider Message
            document.getElementById('simple-payment-view-default').classList.remove('active');
            const providerView = document.getElementById('simple-payment-view-provider');
            providerView.classList.add('active');
            
            // 4. Update Message
            document.getElementById('provider-message').textContent = `선택하신 ${providerName} 앱으로 결제가 진행됩니다.`;
        }

        // Reset Simple Payment Logic (Back to Tabs/List)
        function resetSimplePaymentToDefault() {
            // Deselect all provider buttons
            document.querySelectorAll('#simple-payment-chips .payment-chip-sm').forEach(el => el.classList.remove('active'));
            
            // Show Default View (Tabs + List)
            document.getElementById('simple-payment-view-provider').classList.remove('active');
            document.getElementById('simple-payment-view-default').classList.add('active');
        }

        // Sub-Tabs Logic (Card vs Account)
        function selectSimplePaymentTab(tabEl, tabName) {
            const nav = tabEl.closest('.modal-tab-nav');
            nav.querySelectorAll('.single-chip').forEach(c => c.classList.replace('single-chip-on', 'single-chip-off'));
            tabEl.classList.replace('single-chip-off', 'single-chip-on');

            const wrapper = document.getElementById('simple-payment-view-default');
            wrapper.querySelectorAll('.form-fields-wrapper').forEach(el => el.classList.remove('active'));
            
            const activeContent = document.getElementById(`simple-payment-content-${tabName}`);
            if (activeContent) activeContent.classList.add('active');
        }

        // Horizontal Item Selection
        function selectRegisteredPayment(itemEl) {
             const wrapper = itemEl.closest('.tabs-scroll-wrapper');
             wrapper.querySelectorAll('.horizontal-card-item').forEach(item => {
                 item.classList.remove('selected');
             });
             itemEl.classList.add('selected');
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Default State is set in HTML (Simple Payment -> Default View -> Card Tab)
        });
    </script>
</body>
</html>