<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>성원머니 메인 (v17: 페이지네이션 아이콘 수정)</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* [v12] Master Guide CSS */
        /* Reset & Base */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html, body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f4f5f7; color: #333; font-size: 16px; line-height: 1.6; overflow-x: hidden;
        }
        ul, li { list-style: none; }
        a { text-decoration: none; color: inherit; }
        button { font-family: inherit; border: none; cursor: pointer; background: none; padding: 0; }
        img { max-width: 100%; max-height: 100%; object-fit: contain; display: block; }
        input { font-family: inherit; }
        svg { stroke-width: 2; fill: none; stroke: currentColor; stroke-linecap: round; stroke-linejoin: round; flex-shrink: 0; display: block; }

        /* Layout */
        .mobile-wrap { width: 100%; max-width: 480px; margin: 0 auto; background-color: #ffffff; padding-bottom: 20px; /* Pagination 여백 */ }

        /* Header (v12 Standard) */
        .app-header-sub { height: 56px; background: white; border-bottom: 1px solid #cccccc; display: flex; align-items: center; justify-content: space-between; padding: 0 16px; position: sticky; top: 0; z-index: 100; }
        .header-btn { display: flex; align-items: center; justify-content: center; width: 28px; height: 28px; cursor: pointer; transition: transform 0.2s; color: #333; }
        .header-btn:active { transform: scale(0.9); }
        .header-left { flex: 1 0 0; display: flex; justify-content: flex-start; }
        .header-title { flex: 3 0 0; font-size: 18px; font-weight: 600; text-align: center; color: #212121; }
        .header-right { flex: 1 0 0; display: flex; justify-content: flex-end; gap: 8px; }
        .btn-icon { cursor: pointer; transition: transform 0.2s; display: flex; align-items: center; justify-content: center; flex-shrink: 0; width: 24px; height: 24px; color: #333; }
        .btn-icon:active { transform: scale(0.9); }
        .btn-icon svg { width: 100%; height: 100%; }

        /* Buttons (v12 Standard + Primary) */
        .primary-button { background-color: #4e6ee4; color: white; height: 44px; padding: 7px 19px; border-radius: 6px; border: none; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s; display: inline-flex; align-items: center; justify-content: center; min-width: fit-content; }
        .primary-button:hover { background: #3d5dd3; }
        .primary-button:active { transform: scale(0.98); }
        .dark-button { background: #424242; color: white; height: 44px; padding: 7px 19px; border-radius: 6px; border: none; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s; display: inline-flex; align-items: center; justify-content: center; min-width: fit-content; }
        .dark-button:hover { background: #333; }
        .dark-button:active { transform: scale(0.98); }
        .white-button { background: white; color: #424242; height: 44px; padding: 7px 19px; border-radius: 6px; border: 1px solid #e8e8e9; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s; display: inline-flex; align-items: center; justify-content: center; min-width: fit-content; }
        .white-button:hover { background: #f9f9f9; }
        .white-button:active { transform: scale(0.98); }
        /* v19 (from default) : Disabled state */
        .dark-button:disabled,
        .white-button:disabled,
        .primary-button:disabled {
            background-color: #e9ecef;
            color: #adb5bd;
            border-color: #e9ecef;
            cursor: not-allowed;
        }

        /* Main Content */
        .sw-container { padding: 16px; }

        /* Account Section (v14) */
        .info-section { background: #fff; border: 1px solid #e8e8e9; border-radius: 8px; padding: 16px; margin-bottom: 16px; }
        .info-section .title { font-size: 14px; font-weight: 600; color: #555; margin-bottom: 8px; }
        .info-section .balance-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .info-section .balance { font-size: 24px; font-weight: 700; color: #333; }
        .info-section .balance-row .primary-button { height: 36px; font-size: 13px; }
        .account-info-row { display: flex; align-items: center; justify-content: space-between; padding: 8px 0; cursor: pointer; }
        .account-info-row:hover { background-color: #f8f8f8; }
        .account-info { font-size: 14px; color: #333; word-break: keep-all; flex-grow: 1; margin-right: 8px;}
        .account-info strong { font-weight: 600; }
        .account-chevron { width: 16px; height: 16px; color: #888; flex-shrink: 0; }
        
        /* Status Filter Tabs (v13) */
        .status-tabs { background: #fff; padding: 8px 16px; border-bottom: 1px solid #e9e9e9; margin: 0 -16px 16px -16px; }
        .tabs-scroll-wrapper { overflow-x: auto; white-space: nowrap; -ms-overflow-style: none; scrollbar-width: none; }
        .tabs-scroll-wrapper::-webkit-scrollbar { display: none; }
        .status-tabs ul { display: flex; }
        .status-tabs li { margin-right: 16px; }
        .status-tabs li:last-child { margin-right: 0; }
        .status-tabs li a { display: block; padding: 10px 4px; font-size: 16px; color: #888; border-bottom: 2px solid transparent; white-space: nowrap; }
        .status-tabs li a.active { color: #333; font-weight: 600; border-bottom-color: #333; }

        /* Filter Section (v15) */
        .filter-section { padding: 0 0 16px 0; display: flex; justify-content: flex-start; align-items: center; }
        .text-select-button { display: inline-flex; align-items: center; gap: 4px; cursor: pointer; transition: opacity 0.2s; user-select: none; padding: 8px 0; }
        .text-select-button:hover { opacity: 0.8; }
        .text-select-button:active { transform: scale(0.98); }
        .text-select-button-text { font-size: 14px; color: #2c2c2c; font-weight: 500; white-space: nowrap; }
        .text-select-button-arrow { width: 16px; height: 16px; color: #555; }
        .text-select-button-arrow svg {transition: transform 0.2s;}
        .text-select-button.open .text-select-button-arrow svg {transform: rotate(-180deg);}

        /* Transaction Card (v14) */
        .transaction-list-header { display: flex; justify-content: space-between; align-items: center; padding-bottom: 16px; font-size: 14px; color: #555; border-bottom: 1px solid #f0f0f0; margin-bottom: 16px; }
        .transaction-list-header .total-count strong { font-weight: 600; color: #333; }
        .view-count-select { display: inline-flex; align-items: center; gap: 2px; cursor: pointer; transition: opacity 0.2s; user-select: none; }
        .view-count-select:hover { opacity: 0.8; }
        .view-count-select:active { transform: scale(0.98); }
        .view-count-select-text { font-size: 14px; color: #2c2c2c; font-weight: 400; white-space: nowrap; }
        .view-count-select-arrow { width: 12px; height: 12px; }
        .view-count-select-arrow svg {transition: transform 0.2s; transform: translateY(-2px);}
        .transaction-list { display: flex; flex-direction: column; gap: 12px; margin-bottom: 24px; /* Pagination 여백 */ }
        .transaction-card { border: 1px solid #e0e0e0; border-radius: 8px; background: #fff; overflow: hidden; }
        .card-body { padding: 16px; }
        .card-top { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px; }
        .card-content { font-size: 16px; font-weight: 500; color: #333; margin-right: 16px; }
        .card-amount { font-size: 16px; font-weight: 700; white-space: nowrap; }
        .card-amount.plus { color: #007bff; }
        .card-amount.minus { color: #dc3545; }
        .card-status-fail { font-size: 13px; color: #dc3545; margin-top: 4px; }
        .card-divider { height: 1px; background-color: #f0f0f0; margin: 12px 0; }
        .card-bottom { display: flex; justify-content: space-between; align-items: center; }
        .card-meta { font-size: 13px; color: #666; }
        .card-balance { font-size: 14px; color: #333; text-align: right; }
        .card-balance .label { color: #666; margin-right: 4px; font-size: 13px;}
        .card-balance .value { font-weight: 700; }
        .card-footer { padding: 12px 16px; background-color: #fcfcfc; border-top: 1px solid #f0f0f0; display: flex; justify-content: flex-end; gap: 8px; }
        .card-footer .btn { height: 36px; font-size: 13px; padding: 0 12px; }
        .no-transactions { padding: 40px 16px; text-align: center; color: #888; font-size: 14px; }

        /* [v17] Pagination (Master Guide Img) */
        .pagination { display: flex; align-items: center; justify-content: center; gap: 9px; }
        .pagination-arrow { 
            width: 15px; /* 가이드 기준 크기 조정 */
            height: 15px; 
            cursor: pointer; 
            transition: transform 0.2s; 
            display: flex; align-items: center; justify-content: center; /* 이미지 중앙정렬 */
        }
        .pagination-arrow img { width: 100%; height: auto; } /* 이미지 크기 조정 */
        .pagination-arrow:active { transform: scale(0.9); }
        .pagination-arrow.disabled { opacity: 0.3; cursor: not-allowed; }
        .pagination-numbers { display: flex; gap: 3px; }
        .pagination-number { min-width: 28px; height: 28px; padding: 4px 5px; border-radius: 4px; font-size: 14px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s; user-select: none; }
        .pagination-number.active { background: #4e6ee4; color: white; }
        .pagination-number:not(.active) { background: white; color: #bcbcbc; }
        .pagination-number:not(.active):hover { background: #f5f5f5; }
        .pagination-number:active { transform: scale(0.95); }

        /* Bottom Sheet & Filters (v12 Standard) */
        .bottom-sheet-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: none; align-items: flex-end; justify-content: center; z-index: 1000; animation: fadeIn 0.2s ease-out; }
        .bottom-sheet-overlay.active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        @keyframes slideDown { from { transform: translateY(0); } to { transform: translateY(100%); } }
        .bottom-sheet { width: 100%; max-width: 480px; background: white; border-top: 1px solid #d7d7d7; border-top-left-radius: 8px; border-top-right-radius: 8px; position: relative; animation: slideUp 0.3s ease-out; max-height: 90vh; display: flex; flex-direction: column; }
        .bottom-sheet.closing { animation: slideDown 0.3s ease-out; }
        .sheet-handle { width: 27px; height: 4px; background: #d9d9d9; border-radius: 100px; margin: 10px auto; cursor: grab; }
        .sheet-handle:active { cursor: grabbing; }
        .sheet-header { height: 21px; padding: 0 20px; display: flex; align-items: center; justify-content: center; position: relative; margin-bottom: 20px; }
        .sheet-title { font-size: 16px; font-weight: 700; color: black; }
        .btn-close { position: absolute; right: 20px; top: 0; width: 21px; height: 21px; cursor: pointer; transition: transform 0.2s; }
        .btn-close:active { transform: scale(0.9); }
        .btn-close svg { width: 100%; height: 100%; color: #333; }
        .sheet-body { flex: 1; overflow-y: auto; padding: 0 20px 20px 20px; }
        .filter-group { margin-bottom: 24px; }
        .filter-group-title { font-size: 14px; font-weight: 600; color: #333; margin-bottom: 12px; }
        .filter-group-content { display: flex; flex-wrap: wrap; gap: 8px; }
        .single-chip { display: inline-flex; align-items: center; justify-content: center; padding: 6px 12px; border-radius: 100px; font-size: 14px; cursor: pointer; transition: all 0.2s; user-select: none; }
        .single-chip-off { background: #f5f5f6; color: #8a8a92; }
        .single-chip-on { background: #4e6ee4; color: white; }
        .single-chip:active { transform: scale(0.95); }
        .sheet-footer { padding: 20px; border-top: 1px solid #f0f0f0; background: #fff; display: flex; gap: 8px; }
        .sheet-footer .btn { flex: 1; height: 44px; padding: 7px 19px; border-radius: 6px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s; display: inline-flex; align-items: center; justify-content: center; }
        .option-list { list-style: none; padding: 0; margin: 0; }
        .option-list li { border-bottom: 1px solid #f0f0f0; }
        .option-list li:last-child { border-bottom: none; }
        .option-list li a, .option-list li button { display: block; width: 100%; padding: 16px 20px; font-size: 16px; color: #333; text-align: left; background: none; border: none; cursor: pointer; }
        .option-list li a:hover, .option-list li button:hover { background-color: #f8f8f8; }
        #withdrawal-details-sheet .sheet-body { padding: 20px; }
        .detail-item { display: flex; margin-bottom: 12px; font-size: 14px; }
        .detail-item .label { color: #666; width: 80px; flex-shrink: 0; }
        .detail-item .value { color: #333; font-weight: 500; }
        .detail-item .value.fail-reason { color: #dc3545; }


        /* ========================================
           [NEW] STYLES FOR ADDED COMPONENTS
        ======================================== */

        /* [NEW] Modal (from v19 default) */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 16px;
        }
        .modal-overlay.active {
            display: flex;
            animation: fadeInModal 0.2s ease-out;
        }
        @keyframes fadeInModal {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .modal-content {
            background: white;
            border-radius: 8px;
            width: 100%;
            max-width: 360px; /* Modal max width */
            max-height: 90vh; /* Limit height */
            display: flex;
            flex-direction: column;
            animation: scaleUpModal 0.2s ease-out;
        }
        @keyframes scaleUpModal {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            border-bottom: 1px solid #e8e8e9;
        }
        .modal-title {
            font-size: 16px;
            font-weight: 700;
            color: black;
        }
        .btn-modal-close {
            width: 24px;
            height: 24px;
            cursor: pointer;
            color: #888;
        }
        .btn-modal-close:hover {
            color: #333;
        }
        .modal-body {
            padding: 16px;
            overflow-y: auto;
            flex-grow: 1;
        }
        .modal-footer {
            padding: 16px;
            border-top: 1px solid #e8e8e9;
            background: #fff; /* v17은 푸터 배경색 없음 */
            display: flex;
            gap: 8px;
            border-radius: 0 0 7px 7px;
        }
        .modal-footer .btn {
            flex: 1;
            height: 44px;
            font-size: 14px;
        }

        /* [NEW] Refund Account Modal Specific Styles (from v19 default) */
        #refund-account-modal .modal-body {
            padding-bottom: 0; /* Remove bottom padding if footer exists */
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }
        .readonly-value {
            font-size: 14px;
            color: #333;
            padding: 10px 12px;
            background: #f5f5f5;
            border: 1px solid #e8e8e9;
            border-radius: 6px;
            min-height: 40px;
            display: flex;
            align-items: center;
        }
        .disclaimer {
            font-size: 12px;
            color: #888; /* v17은 #888 */
            margin-top: 8px;
            line-height: 1.5;
        }
        .disclaimer.error { /* v19의 .disclaimer 스타일 */
             color: #dc3545;
        }
        .bank-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .expand-button-wrapper {
            display: flex;
            justify-content: center;
            margin-top: 12px;
        }
        .hidden-bank {
            display: none;
        }
        .banks-expanded .hidden-bank {
            display: inline-flex;
        }
        .input-group {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        .input {
            width: 100%;
            min-height: 40px;
            background: white;
            border: 1px solid #e8e8e9;
            border-radius: 6px;
            padding: 10px 12px;
            display: flex;
            align-items: center;
        }
        .input input {
            width: 100%;
            background: transparent;
            border: none;
            outline: none;
            font-size: 14px;
            color: black;
            line-height: 1.5;
        }
        .input input::placeholder { color: #c6c6c8; }
        .input-group .white-button {
            flex-shrink: 0;
            height: 40px; /* Match input height */
            font-size: 13px;
            padding: 0 12px;
            width: auto; /* v19에서 추가 */
        }
        .verification-message {
            font-size: 12px;
            margin-top: 8px;
            min-height: 1.5em; /* Prevent layout shift */
        }
        .verification-message.success {
            color: #28a745;
        }
        .verification-message.error {
            color: #dc3545;
        }
        
        /* Textarea Style (v12 master guide based) */
        .input textarea {
            width: 100%;
            background: transparent;
            border: none;
            outline: none;
            font-size: 14px;
            font-family: 'Pretendard', sans-serif;
            color: black;
            line-height: 1.5;
            resize: vertical;
        }
        .input textarea::placeholder { color: #c6c6c8; }

        /* Detail Box (for withdrawal sheet) */
        .detail-box {
            padding: 16px;
            background: #f8f8f9;
            border-radius: 6px;
        }
        .detail-box .detail-item:last-child {
            margin-bottom: 0;
        }

        /* Bank List Styles (from v19 default) */
        .account-holder-info {
            font-size: 14px;
            color: #333;
            margin-bottom: 20px;
            padding: 10px;
            background-color: #f8f8f9;
            border-radius: 4px;
        }
        .account-holder-info strong {
            font-weight: 600;
        }
        .bank-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .bank-list li {
            border-bottom: 1px solid #f0f0f0;
        }
        .bank-list li:last-child {
            border-bottom: none;
        }
        .bank-list button {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            padding: 16px 0;
            font-size: 16px;
            color: #333;
            background: none;
            border: none;
            cursor: pointer;
            min-height: 48px;
            text-align: left;
        }
        .bank-list button:hover {
            background-color: #f8f8f8;
        }
        .bank-list .check-icon {
            width: 20px;
            height: 20px;
            color: #4e6ee4;
            margin-left: 10px;
            display: none;
        }
        .bank-list button.selected .check-icon {
            display: block;
        }
        .bank-list button.selected {
            font-weight: 600;
            color: #4e6ee4;
        }

        /* History Table Style (New) */
        .history-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        .history-table th,
        .history-table td {
            padding: 12px 8px;
            border-bottom: 1px solid #f0f0f0;
            text-align: center;
        }
        .history-table th {
            background-color: #f8f8f9;
            color: #555;
            font-weight: 600;
        }
        .history-table td {
            color: #333;
        }
        .history-table tbody tr:last-child td {
            border-bottom: none;
        }

    </style>
</head>
<body>
    <div class="mobile-wrap">
        
        <header class="app-header-sub">
            <div class="header-left">
                <button type="button" class="header-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" id="icon-chevron-left"><path d="M15 6l-6 6l6 6" /></svg>
                </button>
            </div>
            <h1 class="header-title">성원머니</h1>
            <div class="header-right">
                <button type="button" class="btn-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" id="icon-search"><path d="M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0" /><path d="M21 21l-6 -6" /></svg>
                </button>
                <button type="button" class="btn-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" id="icon-cart"><path d="M6 19m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" /><path d="M17 19m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" /><path d="M17 17h-11v-14h-2" /><path d="M6 5l14 1l-1 7h-13" /></svg>
                </button>
            </div>
        </header>

        <main class="sw-container">
            <section class="info-section">
                <div class="title">성원머니</div>
                <div class="balance-row">
                    <span class="balance">₩1,370,000</span>
                    <button type="button" class="primary-button" onclick="showWithdrawalSheet()">출금</button> 
                </div>
                <div class="title" style="margin-top: 16px;">가상계좌</div>
                <div class="account-info-row" onclick="showAccountOptionsSheet()">
                    <div class="account-info"><strong>우리은행 65459011733483 정혜진</strong></div>
                    <div class="account-chevron">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"><path d="M9 6l6 6l-6 6" /></svg>
                    </div>
                </div>
            </section>
            
            <section class="info-section">
                <div class="title">환불계좌</div>
                 <div class="account-info-row" onclick="showRefundAccountModal()">
                     <div class="account-info"><strong>국민은행 213432534543 정혜진</strong></div>
                     <div class="account-chevron">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"><path d="M9 6l6 6l-6 6" /></svg>
                     </div>
                 </div>
             </section>

            <nav class="status-tabs">
                <div class="tabs-scroll-wrapper">
                    <ul id="status-filter-tabs">
                        <li><a href="#" class="active" onclick="filterTransactions('전체', this)">전체</a></li>
                        <li><a href="#" onclick="filterTransactions('입금', this)">입금</a></li>
                        <li><a href="#" onclick="filterTransactions('사용', this)">사용</a></li>
                        <li><a href="#" onclick="filterTransactions('사용취소', this)">사용취소</a></li>
                        <li><a href="#" onclick="filterTransactions('출금', this)">출금</a></li>
                        <li><a href="#" onclick="filterTransactions('소멸', this)">소멸</a></li>
                    </ul>
                </div>
            </nav>

            <section class="filter-section">
                 <button type="button" class="text-select-button" onclick="showFilterSheet()">
                    <span class="text-select-button-text" id="selected-period-text">최근 1개월</span>
                    <div class="text-select-button-arrow">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"><path d="M6 9l6 6l6 -6" /></svg>
                    </div>
                </button>
            </section>

            <section class="transaction-list-section">
                 <div class="transaction-list-header">
                     <span class="total-count">총 <strong id="transaction-count">5</strong>건</span>
                     <div class="view-count-select">
                        <span class="view-count-select-text">20건씩 보기</span>
                        <div class="view-count-select-arrow">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"><path d="M6 9l6 6l6 -6" /></svg>
                        </div>
                    </div>
                 </div>

                 <div class="transaction-list" id="transaction-list-container">
                     <article class="transaction-card" data-type="사용">
                         <div class="card-body">
                             <div class="card-top"><div class="card-content">제품 접수 시 결제금액 차감 (sw823533)</div><div class="card-amount minus">-10,000</div></div>
                             <div class="card-divider"></div>
                             <div class="card-bottom"><div class="card-meta">2025-07-13 12:15 | 사용</div><div class="card-balance"><span class="label">잔액</span><span class="value">1,370,000</span></div></div>
                         </div>
                         <div class="card-footer"> <button type="button" class="white-button btn">상세</button> </div>
                     </article>
                     <article class="transaction-card" data-type="출금">
                         <div class="card-body">
                             <div class="card-top"><div class="card-content">출금 완료</div><div class="card-amount minus">-120,000</div></div>
                             <div class="card-divider"></div>
                             <div class="card-bottom"><div class="card-meta">2025-07-13 12:15 | 출금</div><div class="card-balance"><span class="label">잔액</span><span class="value">1,380,000</span></div></div>
                         </div>
                         <div class="card-footer"> <button type="button" class="white-button btn" onclick="showWithdrawalDetailsSheet({ withdrawer: '김성원', bank: '국민은행', account: '2134***4543', reason: '정상 처리' })">상세</button> </div>
                     </article>
                     <article class="transaction-card" data-type="출금">
                         <div class="card-body">
                             <div class="card-top"><div class="card-content">출금 대기</div><div class="card-amount minus">-50,000</div></div>
                             <div class="card-divider"></div>
                             <div class="card-bottom"><div class="card-meta">2025-07-14 09:30 | 출금</div><div class="card-balance"><span class="label">잔액</span><span class="value">1,330,000</span></div></div>
                         </div>
                         <div class="card-footer"> <button type="button" class="white-button btn" onclick="showWithdrawalDetailsSheet({ withdrawer: '김성원', bank: '국민은행', account: '2134***4543', reason: '처리 중' })">상세</button> <button type="button" class="dark-button btn">출금취소</button> </div>
                     </article>
                     <article class="transaction-card" data-type="출금">
                         <div class="card-body">
                             <div class="card-top">
                                 <div class="card-content">출금 실패<div class="card-status-fail">(사유: 비정상적인 계좌 정보입니다)</div></div>
                                 <div class="card-amount minus">-80,000</div>
                             </div>
                             <div class="card-divider"></div>
                             <div class="card-bottom"><div class="card-meta">2025-07-15 11:00 | 출금</div><div class="card-balance"><span class="label">잔액</span><span class="value">1,330,000</span></div></div>
                         </div>
                         <div class="card-footer"> <button type="button" class="white-button btn" onclick="showWithdrawalDetailsSheet({ withdrawer: '김성원', bank: '국민은행', account: '2134***4543', reason: '비정상적인 계좌 정보입니다' })">상세</button> </div>
                     </article>
                     <article class="transaction-card" data-type="입금">
                         <div class="card-body">
                             <div class="card-top"><div class="card-content">입금 완료</div><div class="card-amount plus">+1,500,000</div></div>
                             <div class="card-divider"></div>
                             <div class="card-bottom"><div class="card-meta">2025-07-12 10:04 | 입금</div><div class="card-balance"><span class="label">잔액</span><span class="value">1,500,000</span></div></div>
                         </div>
                     </article>
                 </div>
                 <div class="no-transactions" style="display: none;">성원머니 거래내역이 없습니다.</div>
                 
                 <div class="pagination" data-name="Pagination">
                    <div class="pagination-arrow disabled" onclick="paginationFirst()">
                        <img src="https://www.figma.com/api/mcp/asset/98c36079-6698-4fbf-8222-1c0b4fcaab1c" alt="처음" style="transform: rotate(90deg);">
                    </div>
                    <div class="pagination-arrow disabled" onclick="paginationPrev()">
                        <img src="https://www.figma.com/api/mcp/asset/5881851a-69b0-4a30-8ba8-bbb647a7fcc4" alt="이전" style="transform: rotate(90deg);">
                    </div>
                    <div class="pagination-numbers" id="pagination-numbers">
                        <div class="pagination-number active" data-page="1" onclick="paginationGo(1)">1</div>
                        <div class="pagination-number" data-page="2" onclick="paginationGo(2)">2</div>
                        <div class="pagination-number" data-page="3" onclick="paginationGo(3)">3</div>
                    </div>
                    <div class="pagination-arrow" onclick="paginationNext()">
                        <img src="https://www.figma.com/api/mcp/asset/9f728346-6da0-4d2b-a299-2137f0214aea" alt="다음" style="transform: rotate(90deg) scaleY(-1);">
                    </div>
                    <div class="pagination-arrow" onclick="paginationLast()">
                        <img src="https://www.figma.com/api/mcp/asset/4557e67d-fb94-45a7-a3da-e8690f677a05" alt="마지막" style="transform: rotate(90deg) scaleY(-1);">
                    </div>
                </div>
            </section>
        </main>
        
    </div>

    <div class="bottom-sheet-overlay" id="filter-sheet-overlay">
        <div class="bottom-sheet" data-name="bottom-sheet" id="filter-sheet">
            <div class="sheet-handle" id="filter-sheet-handle"></div>
            <div class="sheet-header"><div class="sheet-title">기간 상세검색</div><div class="btn-close" onclick="closeFilterSheet()"><svg id="icon-close"><path d="M18 6l-12 12" /><path d="M6 6l12 12" /></svg></div></div>
            <div class="sheet-body" id="filter-sheet-body"><div class="filter-group" id="single-chip-group-period"><div class="filter-group-title">기간</div><div class="filter-group-content"><div class="single-chip single-chip-on" data-value="최근 1개월" onclick="selectPeriod(this)">최근 1개월</div><div class="single-chip single-chip-off" data-value="최근 3개월" onclick="selectPeriod(this)">최근 3개월</div><div class="single-chip single-chip-off" data-value="최근 6개월" onclick="selectPeriod(this)">최근 6개월</div><div class="single-chip single-chip-off" data-value="최근 1년" onclick="selectPeriod(this)">최근 1년</div><div class="single-chip single-chip-off" data-value="기간 설정" onclick="selectPeriod(this)">기간 설정</div></div></div></div>
            <div class="sheet-footer"><button class="btn white-button">초기화</button><button class="btn dark-button" onclick="applyPeriodFilter()">조회하기</button></div>
        </div>
    </div>
    
    <div class="bottom-sheet-overlay" id="account-options-overlay">
        <div class="bottom-sheet" data-name="bottom-sheet" id="account-options-sheet">
            <div class="sheet-handle" id="account-options-handle"></div>
            <div class="sheet-header"><div class="sheet-title">계좌 관리</div><div class="btn-close" onclick="closeAccountOptionsSheet()"><svg id="icon-close-options"><path d="M18 6l-12 12" /><path d="M6 6l12 12" /></svg></div></div>
            <div class="sheet-body">
                <ul class="option-list">
                    <li><button type="button" onclick="alert('발급 확인서 클릭됨'); closeAccountOptionsSheet();">발급 확인서</button></li>
                    <li><button type="button" onclick="showVaHistoryModal(); closeAccountOptionsSheet();">변경내역</button></li>
                    <li><button type="button" onclick="showVaChangeSheet(); closeAccountOptionsSheet();">가상계좌 변경</button></li>
                </ul>
            </div>
        </div>
    </div>

    <div class="bottom-sheet-overlay" id="withdrawal-details-overlay">
        <div class="bottom-sheet" data-name="bottom-sheet" id="withdrawal-details-sheet">
            <div class="sheet-handle" id="withdrawal-details-handle"></div>
            <div class="sheet-header"><div class="sheet-title">출금 상세 정보</div><div class="btn-close" onclick="closeWithdrawalDetailsSheet()"><svg id="icon-close-details"><path d="M18 6l-12 12" /><path d="M6 6l12 12" /></svg></div></div>
            <div class="sheet-body"><div class="detail-item"><span class="label">출금자</span><span class="value" id="detail-withdrawer"></span></div><div class="detail-item"><span class="label">출금은행</span><span class="value" id="detail-bank"></span></div><div class="detail-item"><span class="label">계좌번호</span><span class="value" id="detail-account"></span></div><div class="detail-item"><span class="label">출금사유</span><span class="value" id="detail-reason"></span></div></div>
            <div class="sheet-footer"><button class="btn dark-button" onclick="closeWithdrawalDetailsSheet()">확인</button></div>
        </div>
    </div>


    <div class="modal-overlay" id="refund-account-modal-overlay">
        <div class="modal-content" id="refund-account-modal">
            <div class="modal-header">
                <h2 class="modal-title">환불계좌 변경</h2>
                <button class="btn-modal-close" onclick="closeRefundAccountModal()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        id="icon-close-modal">
                        <path d="M18 6l-12 12" />
                        <path d="M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>예금주</label>
                    <div class="readonly-value">정혜진</div>
                    <p class="disclaimer error">* 환불계좌 변경 시 계좌의 예금주와 회원명이 동일해야만 승인처리가 됩니다.</p>
                </div>
                <div class="form-group">
                    <label>은행명</label>
                    <div class="bank-chips" id="bank-chip-list">
                        <div class="single-chip single-chip-off" data-bank-name="국민은행" onclick="selectBank(this)">국민은행
                        </div>
                        <div class="single-chip single-chip-off" data-bank-name="신한은행" onclick="selectBank(this)">신한은행
                        </div>
                        <div class="single-chip single-chip-off" data-bank-name="우리은행" onclick="selectBank(this)">우리은행
                        </div>
                        <div class="single-chip single-chip-off" data-bank-name="하나은행" onclick="selectBank(this)">하나은행
                        </div>
                        <div class="single-chip single-chip-off" data-bank-name="농협은행" onclick="selectBank(this)">농협은행
                        </div>
                        <div class="single-chip single-chip-off" data-bank-name="기업은행" onclick="selectBank(this)">기업은행
                        </div>
                        <div class="single-chip single-chip-off" data-bank-name="카카오뱅크" onclick="selectBank(this)">카카오뱅크
                        </div>
                        <div class="single-chip single-chip-off" data-bank-name="토스뱅크" onclick="selectBank(this)">토스뱅크
                        </div>
                        <div class="single-chip single-chip-off" data-bank-name="케이뱅크" onclick="selectBank(this)">케이뱅크
                        </div>
                        <div class="single-chip single-chip-off hidden-bank" data-bank-name="SC제일은행"
                            onclick="selectBank(this)">SC제일은행</div>
                        <div class="single-chip single-chip-off hidden-bank" data-bank-name="한국씨티은행"
                            onclick="selectBank(this)">한국씨티은행</div>
                        <div class="single-chip single-chip-off hidden-bank" data-bank-name="산업은행"
                            onclick="selectBank(this)">산업은행</div>
                        <div class="single-chip single-chip-off hidden-bank" data-bank-name="대구은행"
                            onclick="selectBank(this)">대구은행</div>
                        <div class="single-chip single-chip-off hidden-bank" data-bank-name="부산은행"
                            onclick="selectBank(this)">부산은행</div>
                        <div class="single-chip single-chip-off hidden-bank" data-bank-name="광주은행"
                            onclick="selectBank(this)">광주은행</div>
                        <div class="single-chip single-chip-off hidden-bank" data-bank-name="제주은행"
                            onclick="selectBank(this)">제주은행</div>
                        <div class="single-chip single-chip-off hidden-bank" data-bank-name="전북은행"
                            onclick="selectBank(this)">전북은행</div>
                        <div class="single-chip single-chip-off hidden-bank" data-bank-name="경남은행"
                            onclick="selectBank(this)">경남은행</div>
                        <div class="single-chip single-chip-off hidden-bank" data-bank-name="새마을금고"
                            onclick="selectBank(this)">새마을금고</div>
                        <div class="single-chip single-chip-off hidden-bank" data-bank-name="신협"
                            onclick="selectBank(this)">신협</div>
                        <div class="single-chip single-chip-off hidden-bank" data-bank-name="상호저축은행"
                            onclick="selectBank(this)">상호저축은행</div>
                        <div class="single-chip single-chip-off hidden-bank" data-bank-name="NH저축은행"
                            onclick="selectBank(this)">NH저축은행</div>
                        <div class="single-chip single-chip-off hidden-bank" data-bank-name="웰컴저축은행"
                            onclick="selectBank(this)">웰컴저축은행</div>
                        <div class="single-chip single-chip-off hidden-bank" data-bank-name="수협은행"
                            onclick="selectBank(this)">수협은행</div>
                        <div class="single-chip single-chip-off hidden-bank" data-bank-name="우체국"
                            onclick="selectBank(this)">우체국</div>
                        <div class="single-chip single-chip-off hidden-bank" data-bank-name="산림조합"
                            onclick="selectBank(this)">산림조합</div>
                        <div class="single-chip single-chip-off hidden-bank" data-bank-name="미래에셋증권"
                            onclick="selectBank(this)">미래에셋증권</div>
                        <div class="single-chip single-chip-off hidden-bank" data-bank-name="NH투자증권"
                            onclick="selectBank(this)">NH투자증권</div>
                        <div class="single-chip single-chip-off hidden-bank" data-bank-name="유안타증권"
                            onclick="selectBank(this)">유안타증권</div>
                    </div>
                    <div class="expand-button-wrapper">
                        <button type="button" class="text-select-button" id="bank-expand-toggle"
                            onclick="toggleBankList()">
                            <span class="text-select-button-text" id="bank-expand-text">은행 더보기</span>
                            <div class="text-select-button-arrow">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24">
                                    <path d="M6 9l6 6l6 -6" />
                                </svg>
                            </div>
                        </button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="account-number">계좌번호</label>
                    <div class="input-group">
                        <div class="input">
                            <input type="tel" id="account-number" pattern="[0-9]*" placeholder="'-'을 제외하고 숫자만 입력해주세요">
                        </div>
                        <button class="white-button" id="verify-button" onclick="verifyAccountNumber()">인증</button>
                    </div>
                    <p class="verification-message" id="verification-message"></p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn dark-button" id="register-button" onclick="updateRefundAccount()"
                    disabled>변경하기</button>
            </div>
        </div>
    </div>

    <div class="bottom-sheet-overlay" id="withdrawal-sheet-overlay">
        <div class="bottom-sheet" data-name="bottom-sheet" id="withdrawal-sheet">
            <div class="sheet-handle" id="withdrawal-sheet-handle"></div>
            <div class="sheet-header">
                <div class="sheet-title">출금 신청</div>
                <div class="btn-close" onclick="closeWithdrawalSheet()"><svg id="icon-close-withdraw"><path d="M18 6l-12 12" /><path d="M6 6l12 12" /></svg></div>
            </div>
            <div class="sheet-body">
                <div class="form-group">
                    <label>현재 출금 가능 잔액</label>
                    <div class="readonly-value" id="withdraw-balance">₩1,500,000</div>
                </div>
                <div class="form-group">
                    <label for="withdraw-amount">출금 신청 금액</label>
                    <div class="input">
                        <input type="tel" id="withdraw-amount" placeholder="금액을 입력해주세요" oninput="validateWithdrawalForm()">
                    </div>
                    <div class="filter-group-content" style="margin-top: 10px;">
                        <div class="single-chip single-chip-off" onclick="setWithdrawAmount('all')">전액</div>
                        <div class="single-chip single-chip-off" onclick="setWithdrawAmount(1000000)">+100만</div>
                        <div class="single-chip single-chip-off" onclick="setWithdrawAmount(100000)">+10만</div>
                        <div class="single-chip single-chip-off" onclick="setWithdrawAmount(50000)">+5만</div>
                        <div class="single-chip single-chip-off" onclick="setWithdrawAmount(10000)">+1만</div>
                    </div>
                </div>
                <div class="form-group">
                    <label>출금자</label>
                    <div class="readonly-value">홍길동</div>
                </div>
                <div class="form-group">
                    <label>출금 사유</label>
                    <div class="filter-group-content" id="withdraw-reason-chips">
                        <div class="single-chip single-chip-off" data-reason="회계/정산" onclick="selectWithdrawReason(this)">회계/정산</div>
                        <div class="single-chip single-chip-off" data-reason="잔액 회수" onclick="selectWithdrawReason(this)">잔액 회수</div>
                        <div class="single-chip single-chip-off" data-reason="직접 입력" onclick="selectWithdrawReason(this)">직접 입력</div>
                    </div>
                    <p class="disclaimer" style="margin-top: 8px;">* 선택하신 출금 사유는 내부 확인 및 정산 참고용으로만 사용됩니다.</p>
                </div>
                <div class="form-group" id="withdraw-reason-text-group" style="display: none;">
                    <div class="input">
                        <textarea id="withdraw-reason-text" placeholder="출금 사유를 입력해주세요 (500자 이내)" rows="3" oninput="validateWithdrawalForm()"></textarea>
                    </div>
                </div>
                 <div class="form-group">
                    <label>환불계좌 정보</label>
                    <div class="detail-box">
                        <div class="detail-item"><span class="label">예금주</span><span class="value">정혜진</span></div>
                        <div class="detail-item"><span class="label">입금은행</span><span class="value">국민은행</span></div>
                        <div class="detail-item"><span class="label">입금계좌</span><span class="value">27560204147121</span></div>
                    </div>
                </div>
                <div class="form-group">
                    <label>출금 신청 안내</label>
                    <p class="disclaimer" style="color: #666;">* 출금 신청 후 익일 오후 2시 30분까지 취소가 가능합니다.</p>
                    <p class="disclaimer" style="color: #666;">* (금·토·일 신청 건은 월요일 오후 2시 30분 처리)</p>
                </div>
            </div>
            <div class="sheet-footer">
                <button class="btn dark-button" id="withdraw-submit-btn" onclick="submitWithdrawal()" disabled>출금 신청하기</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="va-history-modal-overlay">
        <div class="modal-content" id="va-history-modal">
            <div class="modal-header">
                <h2 class="modal-title">가상계좌 변경내역</h2>
                <button class="btn-modal-close" onclick="closeVaHistoryModal()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                        <path d="M18 6l-12 12" /><path d="M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                
                <table class="history-table">
                    <thead>
                        <tr>
                            <th>변경일</th>
                            <th>기존은행</th>
                            <th>변경은행</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>2025-09-01</td>
                            <td>우리</td>
                            <td>하나</td>
                        </tr>
                         </tbody>
                </table>

                </div>
            <div class="modal-footer">
                <button class="btn dark-button" onclick="closeVaHistoryModal()">확인</button>
            </div>
        </div>
    </div>

    <div class="bottom-sheet-overlay" id="va-change-sheet-overlay">
        <div class="bottom-sheet" data-name="bottom-sheet" id="va-change-sheet">
            <div class="sheet-handle" id="va-change-sheet-handle"></div>
            <div class="sheet-header">
                <div class="sheet-title">가상계좌 변경</div>
                <div class="btn-close" onclick="closeVaChangeSheet()"><svg id="icon-close-va-change"><path d="M18 6l-12 12" /><path d="M6 6l12 12" /></svg></div>
            </div>
            <div class="sheet-body">
                <div class="account-holder-info">예금주: <strong>정혜진</strong></div>
                <div class="filter-group">
                    <div class="filter-group-title">은행</div>
                    <ul class="bank-list" id="va-change-bank-list">
                        <li><button type="button" data-bank-name="IBK기업은행" onclick="selectChangeVaBank(this)">IBK 기업은행 <span class="check-icon"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path d="M5 12l5 5l10 -10" /></svg></span></button></li>
                        <li><button type="button" data-bank-name="우리은행" onclick="selectChangeVaBank(this)">우리은행 <span class="check-icon"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path d="M5 12l5 5l10 -10" /></svg></span></button></li>
                        <li><button type="button" data-bank-name="신한은행" onclick="selectChangeVaBank(this)">신한은행 <span class="check-icon"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path d="M5 12l5 5l10 -10" /></svg></span></button></li>
                        <li><button type="button" data-bank-name="하나은행" onclick="selectChangeVaBank(this)">하나은행 <span class="check-icon"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path d="M5 12l5 5l10 -10" /></svg></span></button></li>
                        <li><button type="button" data-bank-name="NH농협은행" onclick="selectChangeVaBank(this)">NH농협은행 <span class="check-icon"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path d="M5 12l5 5l10 -10" /></svg></span></button></li>
                        <li><button type="button" data-bank-name="Sh수협은행" onclick="selectChangeVaBank(this)">Sh수협은행 <span class="check-icon"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path d="M5 12l5 5l10 -10" /></svg></span></button></li>
                    </ul>
                </div>
                 <div class="form-group" style="margin-top: 24px;">
                    <label>가상계좌 변경 안내</label>
                    <p class="disclaimer" style="color: #666;">* 가상계좌 입금 은행을 변경하신 경우,</p>
                    <p class="disclaimer" style="color: #666;">  변경일로부터 한 달간은 재변경이 불가능합니다.</p>
                </div>
            </div>
            <div class="sheet-footer">
                <button class="btn dark-button" id="va-change-submit-btn" onclick="submitVaChange()" disabled>변경하기</button>
            </div>
        </div>
    </div>


    <script>
        // --- [EXISTING] Bottom Sheet Logic ---
        function setupBottomSheet(overlayId, sheetId, handleId) {
            const overlay = document.getElementById(overlayId); const sheet = document.getElementById(sheetId); const handle = document.getElementById(handleId);
            if (!overlay || !sheet || !handle) return { openSheet: ()=>{}, closeSheet: ()=>{} };
            let isDragging = false, startY = 0, currentY = 0;
            const openSheet = () => { overlay.classList.add('active'); sheet.classList.remove('closing'); document.body.style.overflow = 'hidden'; };
            const closeSheet = () => { sheet.classList.add('closing'); document.body.style.overflow = ''; setTimeout(() => { overlay.classList.remove('active'); sheet.classList.remove('closing'); }, 300); };
            const startDrag = (e) => { isDragging = true; startY = e.type === 'mousedown' ? e.clientY : e.touches[0].clientY; sheet.style.transition = 'none'; };
            const drag = (e) => { if (!isDragging) return; e.preventDefault(); currentY = e.type === 'mousemove' ? e.clientY : e.touches[0].clientY; const deltaY = currentY - startY; if (deltaY > 0) sheet.style.transform = `translateY(${deltaY}px)`; };
            const endDrag = () => { if (!isDragging) return; isDragging = false; sheet.style.transition = ''; const deltaY = currentY - startY; if (deltaY > 100) closeSheet(); else sheet.style.transform = ''; };
            handle.addEventListener('mousedown', startDrag); handle.addEventListener('touchstart', startDrag, { passive: false });
            document.addEventListener('mousemove', drag); document.addEventListener('touchmove', drag, { passive: false });
            document.addEventListener('mouseup', endDrag); document.addEventListener('touchend', endDrag);
            overlay.addEventListener('click', (e) => { if (e.target.id === overlayId) closeSheet(); });
            return { openSheet, closeSheet };
        }
        
        // [EXISTING] Sheet setups
        const { openSheet: showFilterSheet, closeSheet: closeFilterSheet } = setupBottomSheet('filter-sheet-overlay', 'filter-sheet', 'filter-sheet-handle');
        const { openSheet: showAccountOptionsSheet, closeSheet: closeAccountOptionsSheet } = setupBottomSheet('account-options-overlay', 'account-options-sheet', 'account-options-handle');
        // [REMOVED] Refund Account Sheet Setup
        const { openSheet: _showWithdrawalDetailsSheet, closeSheet: closeWithdrawalDetailsSheet } = setupBottomSheet('withdrawal-details-overlay', 'withdrawal-details-sheet', 'withdrawal-details-handle'); // v16

        // --- [NEW] Sheet setups ---
        const { openSheet: showWithdrawalSheet, closeSheet: closeWithdrawalSheet } = setupBottomSheet('withdrawal-sheet-overlay', 'withdrawal-sheet', 'withdrawal-sheet-handle');
        const { openSheet: showVaChangeSheet, closeSheet: closeVaChangeSheet } = setupBottomSheet('va-change-sheet-overlay', 'va-change-sheet', 'va-change-sheet-handle');


        // --- [EXISTING] Filter Component Handlers ---
        let selectedPeriodValue = "최근 1개월"; 
        function selectPeriod(chip) { const group = chip.closest('.filter-group-content'); group.querySelectorAll('.single-chip').forEach(c => c.classList.replace('single-chip-on', 'single-chip-off')); chip.classList.replace('single-chip-off', 'single-chip-on'); selectedPeriodValue = chip.getAttribute('data-value'); }
        function applyPeriodFilter() { document.getElementById('selected-period-text').textContent = selectedPeriodValue; document.querySelector('.text-select-button')?.classList.remove('open'); closeFilterSheet(); console.log("기간 필터 적용:", selectedPeriodValue); /* TODO: Filtering logic */ }
        document.querySelector('.text-select-button')?.addEventListener('click', function() { this.classList.toggle('open'); });

        // --- [EXISTING] Transaction List Filtering ---
        function filterTransactions(status, clickedTab) {
            document.querySelectorAll('#status-filter-tabs a').forEach(tab => tab.classList.remove('active')); clickedTab.classList.add('active');
            const listContainer = document.getElementById('transaction-list-container'); const cards = listContainer.querySelectorAll('.transaction-card'); const noResultMsg = listContainer.parentElement.querySelector('.no-transactions');
            let visibleCount = 0;
            cards.forEach(card => { const cardType = card.getAttribute('data-type'); if (status === '전체' || cardType === status) { card.style.display = ''; visibleCount++; } else { card.style.display = 'none'; } });
            document.getElementById('transaction-count').textContent = visibleCount; noResultMsg.style.display = visibleCount === 0 ? 'block' : 'none';
        }
        
        // --- [EXISTING] Withdrawal Details Bottom Sheet ---
        function showWithdrawalDetailsSheet(details) {
            document.getElementById('detail-withdrawer').textContent = details.withdrawer || '-';
            document.getElementById('detail-bank').textContent = details.bank || '-';
            document.getElementById('detail-account').textContent = details.account || '-';
            const reasonEl = document.getElementById('detail-reason');
            reasonEl.textContent = details.reason || '-';
            reasonEl.classList.toggle('fail-reason', details.reason && (details.reason.includes('실패') || details.reason.includes('비정상')));
            _showWithdrawalDetailsSheet(); 
        }

        // --- [EXISTING] Pagination Logic ---
        let currentPage = 1; const totalPages = 3; 
        function paginationGo(page) { currentPage = page; updatePagination(); console.log('Page changed to:', page); /* TODO: Fetch data */ }
        function paginationPrev() { if (currentPage > 1) paginationGo(currentPage - 1); }
        function paginationNext() { if (currentPage < totalPages) paginationGo(currentPage + 1); }
        function paginationFirst() { paginationGo(1); }
        function paginationLast() { paginationGo(totalPages); }
        function updatePagination() {
            const numbers = document.querySelectorAll('.pagination-number'); const prevArrows = document.querySelectorAll('.pagination .pagination-arrow:nth-child(-n+2)'); const nextArrows = document.querySelectorAll('.pagination .pagination-arrow:nth-child(n+4)');
            numbers.forEach(num => { num.classList.remove('active'); if (parseInt(num.dataset.page) === currentPage) num.classList.add('active'); });
            prevArrows.forEach(arrow => arrow.classList.toggle('disabled', currentPage === 1)); nextArrows.forEach(arrow => arrow.classList.toggle('disabled', currentPage === totalPages));
        }


        // ========================================
        // [NEW] JAVASCRIPT FOR NEW COMPONENTS
        // ========================================

        // --- 1. Withdrawal Sheet Logic ---
        const withdrawAmountInput = document.getElementById('withdraw-amount');
        const withdrawReasonTextGroup = document.getElementById('withdraw-reason-text-group');
        const withdrawReasonText = document.getElementById('withdraw-reason-text');
        const withdrawReasonChips = document.getElementById('withdraw-reason-chips');
        const withdrawSubmitBtn = document.getElementById('withdraw-submit-btn');

        let currentWithdrawBalance = 1500000; // 예시 잔액
        let selectedWithdrawReason = null;

        function setWithdrawAmount(amount) {
            if (amount === 'all') {
                withdrawAmountInput.value = currentWithdrawBalance;
            } else {
                const currentVal = parseInt(withdrawAmountInput.value) || 0;
                withdrawAmountInput.value = currentVal + amount;
            }
            validateWithdrawalForm();
        }

        function selectWithdrawReason(chip) {
            withdrawReasonChips.querySelectorAll('.single-chip').forEach(c => c.classList.replace('single-chip-on', 'single-chip-off'));
            chip.classList.replace('single-chip-off', 'single-chip-on');
            selectedWithdrawReason = chip.getAttribute('data-reason');

            if (selectedWithdrawReason === '직접 입력') {
                withdrawReasonTextGroup.style.display = 'block';
            } else {
                withdrawReasonTextGroup.style.display = 'none';
                withdrawReasonText.value = '';
            }
            validateWithdrawalForm();
        }

        function validateWithdrawalForm() {
            const amount = parseInt(withdrawAmountInput.value) || 0;
            let reasonIsValid = false;

            if (selectedWithdrawReason && selectedWithdrawReason !== '직접 입력') {
                reasonIsValid = true;
            } else if (selectedWithdrawReason === '직접 입력' && withdrawReasonText.value.trim().length > 0) {
                reasonIsValid = true;
            }

            // 출금 신청 버튼 활성화
            if (amount > 0 && amount <= currentWithdrawBalance && reasonIsValid) {
                withdrawSubmitBtn.disabled = false;
            } else {
                withdrawSubmitBtn.disabled = true;
            }
        }
        
        function submitWithdrawal() {
            const amount = withdrawAmountInput.value;
            let reason = selectedWithdrawReason;
            if (reason === '직접 입력') {
                reason = withdrawReasonText.value;
            }
            console.log(`출금 신청: ${amount}원, 사유: ${reason}`);
            alert("출금 신청이 완료되었습니다. (구현 필요)");
            closeWithdrawalSheet();
            // 폼 초기화
            withdrawAmountInput.value = '';
            withdrawReasonChips.querySelectorAll('.single-chip').forEach(c => c.classList.replace('single-chip-on', 'single-chip-off'));
            withdrawReasonTextGroup.style.display = 'none';
            withdrawReasonText.value = '';
            withdrawSubmitBtn.disabled = true;
            selectedWithdrawReason = null;
        }

        // --- 2. VA Change History Modal Logic ---
        const vaHistoryModalOverlay = document.getElementById('va-history-modal-overlay');
        function showVaHistoryModal() {
            if (vaHistoryModalOverlay) {
                vaHistoryModalOverlay.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
        }
        function closeVaHistoryModal() {
            if (vaHistoryModalOverlay) {
                vaHistoryModalOverlay.classList.remove('active');
                document.body.style.overflow = '';
            }
        }
        // Add overlay click to close
        if (vaHistoryModalOverlay) {
            vaHistoryModalOverlay.addEventListener('click', (e) => {
                if (e.target.id === 'va-history-modal-overlay') {
                    closeVaHistoryModal();
                }
            });
        }

        
        // --- 3. VA Change Sheet Logic ---
        const vaChangeBankList = document.getElementById('va-change-bank-list');
        const vaChangeSubmitBtn = document.getElementById('va-change-submit-btn');
        let selectedChangeVaBank = null;

        function selectChangeVaBank(buttonElement) {
            vaChangeBankList.querySelectorAll('button').forEach(btn => btn.classList.remove('selected'));
            buttonElement.classList.add('selected');
            selectedChangeVaBank = buttonElement.getAttribute('data-bank-name');
            vaChangeSubmitBtn.disabled = false; // 은행 선택 시 버튼 활성화
        }

        function submitVaChange() {
            if (!selectedChangeVaBank) {
                alert("은행을 선택해주세요.");
                return;
            }
            console.log(`가상계좌 변경: ${selectedChangeVaBank}`);
            alert(`${selectedChangeVaBank}로 가상계좌 변경이 요청되었습니다. (구현 필요)`);
            
            // 폼 초기화
            vaChangeBankList.querySelectorAll('button').forEach(btn => btn.classList.remove('selected'));
            vaChangeSubmitBtn.disabled = true;
            selectedChangeVaBank = null;
            
            closeVaChangeSheet();
        }

        // --- [NEW] Refund Account Modal Logic (from v19) ---
        const refundModalOverlay = document.getElementById('refund-account-modal-overlay');
        const refundModal = document.getElementById('refund-account-modal');
        const bankChipList = document.getElementById('bank-chip-list');
        const accountNumberInput = document.getElementById('account-number');
        const verifyButton = document.getElementById('verify-button');
        const verificationMessage = document.getElementById('verification-message');
        const registerButton = document.getElementById('register-button');
        const bankExpandToggle = document.getElementById('bank-expand-toggle');
        const bankExpandText = document.getElementById('bank-expand-text');
        
        let selectedBankChip = null;
        let isVerified = false;

        function showRefundAccountModal() {
            // Reset modal state before showing
            isVerified = false;
            selectedBankChip = null;
            if (bankChipList) {
                bankChipList.querySelectorAll('.single-chip').forEach(c => c.classList.replace('single-chip-on', 'single-chip-off'));
            }
            if(accountNumberInput) accountNumberInput.value = '';
            if(accountNumberInput) accountNumberInput.disabled = false;
            if(verificationMessage) verificationMessage.textContent = '';
            if(verificationMessage) verificationMessage.className = 'verification-message';
            if(verifyButton) verifyButton.textContent = '인증';
            if(verifyButton) verifyButton.disabled = false;
            if(registerButton) registerButton.disabled = true;

            // Reset bank expand button
            if (bankChipList) bankChipList.classList.remove('banks-expanded');
            if (bankExpandToggle) bankExpandToggle.classList.remove('open');
            if (bankExpandText) bankExpandText.textContent = '은행 더보기';

            if (refundModalOverlay) refundModalOverlay.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeRefundAccountModal() {
            if (refundModalOverlay) refundModalOverlay.classList.remove('active');
            document.body.style.overflow = '';
        }

        function selectBank(chipElement) {
            bankChipList.querySelectorAll('.single-chip').forEach(c => c.classList.replace('single-chip-on', 'single-chip-off'));
            chipElement.classList.replace('single-chip-off', 'single-chip-on');
            selectedBankChip = chipElement;
            resetVerification();
        }
        
        function toggleBankList() {
            const isExpanded = bankChipList.classList.toggle('banks-expanded');
            bankExpandToggle.classList.toggle('open', isExpanded);
            bankExpandText.textContent = isExpanded ? '접기' : '은행 더보기';
        }

        function resetVerification() {
            isVerified = false;
            accountNumberInput.disabled = false;
            verificationMessage.textContent = '';
            verificationMessage.className = 'verification-message';
            verifyButton.textContent = '인증';
            verifyButton.disabled = false;
            registerButton.disabled = true;
        }

        function verifyAccountNumber() {
            const accountNumber = accountNumberInput.value.trim();
            if (!selectedBankChip) {
                verificationMessage.textContent = '은행명을 먼저 선택해주세요.';
                verificationMessage.className = 'verification-message error';
                return;
            }
            if (!accountNumber) {
                verificationMessage.textContent = '계좌번호를 입력해주세요.';
                verificationMessage.className = 'verification-message error';
                return;
            }
            console.log(`Verifying: ${selectedBankChip.dataset.bankName} - ${accountNumber}`);
            verifyButton.textContent = '인증 중...';
            verifyButton.disabled = true;
            setTimeout(() => {
                // 테스트용 인증 로직 (123123123)
                const success = accountNumber === '123123123'; 
                if (success) {
                    isVerified = true;
                    verificationMessage.textContent = '인증이 완료되었습니다.';
                    verificationMessage.className = 'verification-message success';
                    verifyButton.textContent = '인증 완료';
                    accountNumberInput.disabled = true;
                    registerButton.disabled = false;
                } else {
                    isVerified = false;
                    verificationMessage.textContent = '계좌번호 인증에 실패했어요. 다시 확인하신 후 인증을 진행해주세요';
                    verificationMessage.className = 'verification-message error';
                    verifyButton.textContent = '재인증';
                    verifyButton.disabled = false;
                    registerButton.disabled = true;
                }
            }, 1000);
        }

        // [MODIFIED] Renamed function
        function updateRefundAccount() {
            if (!isVerified) { alert("계좌 인증을 먼저 완료해주세요."); return; }
            const bankName = selectedBankChip.dataset.bankName;
            const accountNumber = accountNumberInput.value.trim();
            // [MODIFIED] Console/Alert message
            console.log(`Updating Refund Account: ${bankName} - ${accountNumber}`);
            alert(`환불계좌 변경 요청:\n은행: ${bankName}\n계좌: ${accountNumber}\n(구현 필요)`);
            closeRefundAccountModal();
        }

        // --- [MODIFIED] Initialize (Event listeners etc.) ---
        document.addEventListener('DOMContentLoaded', () => {
            // For Pagination
            updatePagination(); 
            
            // For Refund Modal
            // (변수 DOMContentLoaded 밖으로 이동)
            refundModal?.addEventListener('click', (e) => e.stopPropagation());
            refundModalOverlay?.addEventListener('click', (e) => {
                 if (e.target.id === 'refund-account-modal-overlay') {
                    closeRefundAccountModal();
                 }
            });
            accountNumberInput?.addEventListener('input', () => {
                if (isVerified) {
                    resetVerification();
                }
            });
        });

    </script>
</body>
</html>